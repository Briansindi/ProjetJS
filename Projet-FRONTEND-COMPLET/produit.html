<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="product-title">Nom du produit</title>
  <link rel="stylesheet" href="style4.css" />
</head>
<body>
  <header>
    <div class="container">
      <div class="logo">
        <a href="index.html"><img src="MaillotsCAN/original.png" alt="Logo ABY"></a>
      </div>
      <nav>
        <ul class="nav-links">
          <li><a href="index.html">Accueil</a></li>
          <li><a href="produits.html">Produits</a></li>
          <li><a href="register.html">Inscription</a></li>
        </ul>
      </nav>
      <div class="user-icons">
        <a href="panier.html"><img src="MaillotsCAN/Logo-panier.png" alt="Panier" /><span class="cart-count" id="cart-count">0</span></a>
      </div>
    </div>
  </header>

  <main class="product-detail-main">
    <div class="product-detail-container">
      <div class="product-detail-img">
        <img id="product-img" src="" alt="Image du produit">
      </div>
      <div class="product-detail-info">
        <h1 id="product-name">Nom du produit</h1>
        <p id="product-description">Description du produit</p>
        <p id="product-price">Prix: 0.00€</p>
        <div class="product-options">
          <h3>Taille</h3>
          <select id="product-size">
            <option value="XS">XS</option>
            <option value="S">S</option>
            <option value="M">M</option>
            <option value="L">L</option>
            <option value="XL">XL</option>
          </select>
        </div>
        <div class="product-actions">
          <button id="add-to-cart">Ajouter au panier</button>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 ABY</p>
      <ul>
        <li><a href="#">CGV</a></li>
        <li><a href="#">Politique de confidentialité</a></li>
        <li><a href="#">Mentions légales</a></li>
      </ul>
      <div class="social-icons">
        <a href="#"><img src="MaillotsCAN/icon-facebook.jpeg" alt="Facebook"></a>
        <a href="#"><img src="MaillotsCAN/Icon-X.avif" alt="Twitter"></a>
        <a href="#"><img src="MaillotsCAN/icon-Instagram.avif" alt="Instagram"></a>
      </div>
    </div>
  </footer>

  <script>
    // Récupérer l'ID du produit depuis l'URL
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');
    
    // Fonction pour charger les détails du produit
    async function loadProductDetails() {
      try {
        // Essayer de récupérer depuis l'API
        const response = await fetch(`http://localhost:5002/api/products/${productId}`);
        if (response.ok) {
          const product = await response.json();
          displayProductDetails(product);
          setupAddToCart(product);
        } else {
          // Si l'API ne répond pas, utiliser les données locales
          const localProducts = [
{ _id: "1", nom: "T-shirt Homme Coton", description: "T-shirt 100% coton, coupe classique", prix: 19.99, categorie: "Homme", image: "tshirt-homme.jpg" },
{ _id: "2", nom: "Jean Slim Homme", description: "Jean slim en denim bleu foncé", prix: 39.99, categorie: "Homme", image: "pantalonclassique.png" },
{ _id: "3", nom: "Chemise à Carreaux", description: "Chemise à carreaux en flanelle, idéale pour l'hiver", prix: 24.99, categorie: "Homme", image: "chemise-homme.jpg" },
{ _id: "4", nom: "Veste en Jean", description: "Veste en jean bleu classique", prix: 59.99, categorie: "Homme", image: "vesteenjean1.png" },

{ _id: "5", nom: "Blouse Femme Chic", description: "Blouse fluide et élégante pour toutes les occasions", prix: 29.99, categorie: "Femme", image: "blouse-femme.jpg" },
{ _id: "6", nom: "Pantalon Large Femme", description: "Pantalon coupe large en lin, très confortable", prix: 34.99, categorie: "Femme", image: "pantalon-femme.jpg" },
{ _id: "7", nom: "Robe d'Été Fleurie", description: "Robe légère à fleurs, parfaite pour les journées ensoleillées", prix: 44.99, categorie: "Femme", image: "robe-femme.jpg" },
{ _id: "8", nom: "Cardigan Tricoté", description: "Cardigan doux et chaud pour l'automne", prix: 39.99, categorie: "Femme", image: "cardigan-femme.jpg" },

{ _id: "9", nom: "T-shirt Enfant Motif", description: "T-shirt coloré avec motifs amusants", prix: 14.99, categorie: "Enfant", image: "tshirt-enfant.jpg" },
{ _id: "10", nom: "Short Enfant Été", description: "Short léger pour l'été, 100% coton", prix: 12.99, categorie: "Enfant", image: "short-enfant.jpg" },
{ _id: "11", nom: "Pyjama Enfant", description: "Pyjama deux pièces confortable pour les nuits fraîches", prix: 17.99, categorie: "Enfant", image: "pyjama-enfant.jpg" },
{ _id: "12", nom: "Sweat Enfant", description: "Sweat à capuche enfant avec motif animal", prix: 22.99, categorie: "Enfant", image: "sweat-enfant.jpg" },

{ _id: "13", nom: "Sac à Main Cuir", description: "Sac à main en simili cuir avec bandoulière", prix: 49.99, categorie: "Accessoires", image: "sac-femme.jpg" },
{ _id: "14", nom: "Casquette Classique", description: "Casquette unisexe en coton", prix: 15.99, categorie: "Accessoires", image: "casquette-homme.jpg" },
{ _id: "15", nom: "Lunettes de Soleil", description: "Lunettes UV tendance unisexe", prix: 18.99, categorie: "Accessoires", image: "lunettes.jpg" },
];
          
          const product = localProducts.find(p => p._id === productId);
          if (product) {
            displayProductDetails(product);
            setupAddToCart(product);
          } else {
            document.querySelector('.product-detail-container').innerHTML = '<p>Produit non trouvé</p>';
          }
        }
      } catch (error) {
        console.error("Erreur lors du chargement du produit:", error);
        // Utiliser les données locales en cas d'erreur
        const localProducts = [
          { _id: "1", nom: "T-shirt Homme Coton", description: "T-shirt 100% coton, coupe classique", prix: 19.99, categorie: "Homme", image: "tshirt-homme.jpg" },
        
        ];
        const product = localProducts.find(p => p._id === productId);
        if (product) {
          displayProductDetails(product);
          setupAddToCart(product);
        } else {
          document.querySelector('.product-detail-container').innerHTML = '<p>Produit non trouvé</p>';
        }
      }
    }
    
    // Afficher les détails du produit
    function displayProductDetails(product) {
      document.getElementById('product-title').textContent = product.nom;
      document.getElementById('product-img').src = `MaillotsCAN/${product.image}`;
      document.getElementById('product-name').textContent = product.nom;
      document.getElementById('product-description').textContent = product.description;
      document.getElementById('product-price').textContent = `Prix: ${product.prix.toFixed(2)}€`;
    }
    
    // Configurer le bouton "Ajouter au panier"
    function setupAddToCart(product) {
      document.getElementById('add-to-cart').addEventListener('click', () => {
        ajouterAuPanier(product);
      });
    }
    
    // Fonction pour ajouter au panier
    function ajouterAuPanier(product) {
      const panier = JSON.parse(localStorage.getItem("panier") || "[]");
      const tailleSelectionnee = document.getElementById('product-size').value;
      
      // Vérifier si le produit avec la même taille est déjà dans le panier
      const produitExistant = panier.find(p => 
        p._id === product._id && p.taille === tailleSelectionnee
      );
      
      if (produitExistant) {
        produitExistant.quantite += 1;
      } else {
        panier.push({ 
          ...product, 
          quantite: 1,
          taille: tailleSelectionnee
        });
      }
      
      localStorage.setItem("panier", JSON.stringify(panier));
      
      // Mettre à jour le compteur du panier
      updateCartCount();
      
      // Notification d'ajout au panier
      alert(`${product.nom} (Taille: ${tailleSelectionnee}) ajouté au panier`);
    }
    
    // Mettre à jour le compteur du panier
    function updateCartCount() {
      const panier = JSON.parse(localStorage.getItem("panier") || "[]");
      document.getElementById('cart-count').textContent = panier.length;
    }
    
    // Charger les détails du produit au chargement de la page
    document.addEventListener("DOMContentLoaded", () => {
      if (productId) {
        loadProductDetails();
      } else {
        document.querySelector('.product-detail-container').innerHTML = '<p>Aucun produit sélectionné</p>';
      }
      
      // Initialiser le compteur du panier
      updateCartCount();
    });
  </script>
</body>
</html>